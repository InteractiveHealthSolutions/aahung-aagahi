<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="Schools_eligible_for_exit_tier" language="java" pageWidth="1750" pageHeight="612" orientation="Landscape" whenNoDataType="AllSectionsNoDetail" columnWidth="1710" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="11e312b6-b79a-482a-bdbf-f03ca611f38c">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<style name="Title" fontName="DejaVu Sans" fontSize="26" isBold="true" pdfFontName="Helvetica-Bold"/>
	<style name="SubTitle" forecolor="#666666" fontName="DejaVu Sans" fontSize="18"/>
	<style name="Column header" forecolor="#666666" fontName="DejaVu Sans" fontSize="12" isBold="true"/>
	<style name="Detail" fontName="DejaVu Sans" fontSize="12"/>
	<parameter name="start_date" class="java.util.Date">
		<parameterDescription><![CDATA[]]></parameterDescription>
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="end_date" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="province" class="java.lang.String">
		<parameterDescription><![CDATA[]]></parameterDescription>
		<defaultValueExpression><![CDATA["Sindh"]]></defaultValueExpression>
	</parameter>
	<parameter name="city" class="java.lang.String">
		<defaultValueExpression><![CDATA["Khairpur"]]></defaultValueExpression>
	</parameter>
	<parameter name="school_level" class="java.lang.String">
		<defaultValueExpression><![CDATA["Primary"]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT
sd.location_id,
    sd.`school_id`,
    sd.`school_name`,
        sd.`partnership_start_date`,
    	sd.`school_level`,
        sd.`school_tier`,
        sd.school_category_running,

if(school_level='Primary',pmn2.date_created,smn2.date_created) as date_created2,
if(school_level='Primary',pmn2.monitoring_score_pct,smn2.monitoring_score_pct) as monitoring_score_pct2,
if(school_level='Primary',pmn1.date_created,smn1.date_created) as date_created1,
if(school_level='Primary',pmn1.monitoring_score_pct,smn1.monitoring_score_pct) as monitoring_score_pct1,

sum(if(meca.mt_eligible='281',1,0)) as no_eligible_mt,
if(if(school_level='Primary',pmn1.monitoring_score_pct,smn1.monitoring_score_pct)>=85 and if(school_level='Primary',pmn2.monitoring_score_pct,smn2.monitoring_score_pct)>=85 and sum(if(meca.mt_eligible='281',1,0))>0,'yes','No' ) as diff_score


FROM `aagahi`.`school_detail` sd


left join _lse_primary_monitoring as pmn1 on sd.location_id=pmn1.location_id and pmn1.date_created=(select date_created from _lse_primary_monitoring_running where location_id=pmn1.location_id order by date_created desc limit 0,1)
left join _lse_secondary_monitoring as smn1 on sd.location_id=smn1.location_id and smn1.date_created=(select date_created from _lse_secondary_monitoring_running where location_id=smn1.location_id order by date_created desc limit 0,1)
left join _lse_primary_monitoring as pmn2 on sd.location_id=pmn2.location_id and pmn2.date_created=(select date_created from _lse_primary_monitoring_running where location_id=pmn2.location_id order by date_created desc limit 1,1)
left join _lse_secondary_monitoring as smn2 on sd.location_id=smn2.location_id and smn2.date_created=(select date_created from _lse_secondary_monitoring_running where location_id=smn2.location_id order by date_created desc limit 1,1)

left join _lse_mt_eligibility_criteria_assessment as meca on meca.location_id=sd.location_id




where date(sd.`partnership_start_date`) between date($P{start_date}) and date($P{end_date})  and
find_in_set(sd.`province`,$P{province}) and find_in_set(sd.`city`,$P{city}) and find_in_set(sd.`school_level`,$P{school_level}) and sd.school_category_running='High Performing' and sd.school_tier='Running'
and sd.`partnership_start_date`<= subdate(current_date() ,interval 24 month)

group by sd.location_id;]]>
	</queryString>
	<field name="location_id" class="java.lang.Integer">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="school_id" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="school_name" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="partnership_start_date" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="school_level" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="school_tier" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="school_category_running" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="date_created2" class="java.sql.Timestamp"/>
	<field name="monitoring_score_pct2" class="java.lang.Double"/>
	<field name="date_created1" class="java.sql.Timestamp"/>
	<field name="monitoring_score_pct1" class="java.lang.Double"/>
	<field name="no_eligible_mt" class="java.math.BigDecimal"/>
	<field name="diff_score" class="java.lang.String"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="111" splitType="Stretch">
			<staticText>
				<reportElement style="SubTitle" x="119" y="47" width="422" height="49" uuid="84459224-1520-4f69-99e7-192d5eb078c4"/>
				<textElement>
					<font size="14" isItalic="true"/>
				</textElement>
				<text><![CDATA[Provide information on which schools are eligible to move from the running to the exit tier.]]></text>
			</staticText>
			<staticText>
				<reportElement style="Title" x="2" y="14" width="372" height="33" uuid="1e808589-5caa-485c-8475-8aba952c4436"/>
				<textElement verticalAlignment="Middle"/>
				<text><![CDATA[Schools Eligible For Exit Tier]]></text>
			</staticText>
			<image>
				<reportElement x="587" y="1" width="87" height="95" uuid="0d493b0e-2916-4075-ab6e-7af7537899b9"/>
				<imageExpression><![CDATA["/usr/local/tomcat/webapps/aahung-aagahi/WEB-INF/classes/rpt/aahung-logo_e51b25d4.png"]]></imageExpression>
			</image>
		</band>
	</title>
	<columnHeader>
		<band height="36" splitType="Stretch">
			<line>
				<reportElement positionType="FixRelativeToBottom" x="0" y="35" width="1693" height="1" uuid="74044e20-9625-4dc5-8bcb-0bcdf732875e"/>
				<graphicElement>
					<pen lineWidth="0.5" lineColor="#999999"/>
				</graphicElement>
			</line>
			<staticText>
				<reportElement x="0" y="0" width="133" height="15" forecolor="#666666" uuid="82f7df27-ad6d-4f69-ac91-32fa4a410368"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[school_id]]></text>
			</staticText>
			<staticText>
				<reportElement x="133" y="0" width="122" height="15" forecolor="#666666" uuid="8e571c95-378a-471f-9e9e-931296aa4b44"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[school_name]]></text>
			</staticText>
			<staticText>
				<reportElement x="255" y="0" width="112" height="15" forecolor="#666666" uuid="391d602f-e3ee-4780-b980-59575025691a"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[school_level]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Transparent" x="367" y="0" width="190" height="15" forecolor="#666666" uuid="d2aa28bd-9628-4683-95bc-8e26bb083528"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[school_category_running]]></text>
			</staticText>
			<staticText>
				<reportElement x="557" y="0" width="127" height="15" forecolor="#666666" uuid="1080f841-5199-429b-b4e7-389e7077f77b"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[date_created2]]></text>
			</staticText>
			<staticText>
				<reportElement x="684" y="0" width="176" height="15" forecolor="#666666" uuid="a65c1a06-c04c-4290-a77f-c01c33fe923d"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[monitoring_score_pct2]]></text>
			</staticText>
			<staticText>
				<reportElement x="860" y="0" width="129" height="15" forecolor="#666666" uuid="e0ac2b62-c654-49b2-a2ad-24ffd108f822"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[date_created1]]></text>
			</staticText>
			<staticText>
				<reportElement x="989" y="0" width="179" height="15" forecolor="#666666" uuid="4b9749de-6374-4584-980b-5a6542f6adc3"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[monitoring_score_pct1]]></text>
			</staticText>
			<staticText>
				<reportElement x="1168" y="0" width="127" height="15" forecolor="#666666" uuid="4c2880e1-4767-4552-97cd-4f36bd8be25d"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[no_eligible_mt]]></text>
			</staticText>
			<staticText>
				<reportElement x="1295" y="0" width="100" height="15" forecolor="#666666" uuid="aa4c5914-3083-4097-9eb9-1aee4ca401ab"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[diff_score]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="49" splitType="Stretch">
			<textField isStretchWithOverflow="true">
				<reportElement x="0" y="0" width="133" height="20" uuid="6b9467cf-5287-4530-8743-8a14f4bfd50c"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{school_id}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement x="133" y="0" width="122" height="20" uuid="5b450f7d-31bb-4b68-bfaa-ff1be8cb35fd"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{school_name}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement x="255" y="0" width="112" height="20" uuid="36c5f2b0-6dd6-4b2a-b346-ca62fa8329f7"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{school_level}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement x="367" y="0" width="190" height="20" uuid="0c7f10bd-2825-456a-b501-fb266718e441"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{school_category_running}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement x="557" y="0" width="127" height="20" uuid="eb35ea84-5a96-450c-84c4-f70124a6fde4"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{date_created2}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement x="684" y="0" width="176" height="20" uuid="bde1ff16-1151-4184-ace3-ecfa9c03c34e"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{monitoring_score_pct2}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement x="860" y="0" width="129" height="20" uuid="19d78357-4600-4c65-8548-014780bc71c9"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{date_created1}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement x="989" y="0" width="179" height="20" uuid="8e88b252-07c4-42c9-8a6f-67cb51ac2729"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{monitoring_score_pct1}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement x="1168" y="0" width="127" height="20" uuid="12aca403-d96a-496e-967d-218392cb22c9"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{no_eligible_mt}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement x="1295" y="0" width="100" height="20" uuid="85336e45-7963-4dbd-9744-106778f209ad"/>
				<textElement>
					<font fontName="DejaVu Sans" size="12"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{diff_score}]]></textFieldExpression>
			</textField>
			<line>
				<reportElement positionType="FixRelativeToBottom" x="0" y="37" width="1693" height="1" uuid="2720e5cc-ad34-467e-9b46-f93b56f866cc"/>
				<graphicElement>
					<pen lineWidth="0.5" lineColor="#999999"/>
				</graphicElement>
			</line>
		</band>
	</detail>
	<columnFooter>
		<band height="45" splitType="Stretch">
			<line>
				<reportElement positionType="FixRelativeToBottom" x="0" y="3" width="555" height="1" uuid="7b512043-b581-4ef4-af3b-c1679c4a0ead"/>
				<graphicElement>
					<pen lineWidth="0.5" lineColor="#999999"/>
				</graphicElement>
			</line>
		</band>
	</columnFooter>
	<pageFooter>
		<band height="20" splitType="Stretch">
			<textField pattern="EEEEE dd MMMMM yyyy">
				<reportElement style="Column header" x="0" y="0" width="197" height="20" uuid="1421220b-374b-4501-9c91-e99bd82d2af4"/>
				<textElement>
					<font size="10" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement style="Column header" x="513" y="0" width="40" height="20" uuid="6ce0875e-3a42-40c1-9b37-7b6c9428824d"/>
				<textElement>
					<font size="10" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement style="Column header" x="433" y="0" width="80" height="20" uuid="2f4417ca-3410-4abd-b852-ffd8c87ff4ad"/>
				<textElement textAlignment="Right">
					<font size="10" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA["Page "+$V{PAGE_NUMBER}+" of"]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<summary>
		<band height="42" splitType="Stretch"/>
	</summary>
</jasperReport>
